
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FC - Cognate Puzzle (Vocal Only)</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f8ff; text-align: center; padding: 40px; }
    h1 { font-size: 2em; color: #2c3e50; }
    .words button {
      font-size: 1.1em;
      margin: 10px;
      padding: 10px 20px;
      cursor: pointer;
    }
    #result, #score, #hiddenWord, #listening {
      margin-top: 25px;
      font-size: 1.2em;
    }
    #hiddenWord { font-size: 2em; letter-spacing: 12px; }
    #listening { color: #0077cc; font-weight: bold; }
  </style>
</head>
<body>
  <h1>🎯 Cognate Puzzle</h1>
  <p>Unlock the hidden word by pronouncing the right cognates</p>
  <div id="hiddenWord"></div>
  <div class="words" id="wordList"></div>
  <div id="listening"></div>
  <div id="result"></div>
  <div id="score"></div>

  <script>
    const puzzle = {
      target: "TABLE",
      options: ["TALENT", "ANTIQUE", "BUREAU", "LIBERAL", "EPISODE"],
      accepted: {
        "TALENT": ["TALENT", "TALEN", "TALANT"],
        "ANTIQUE": ["ANTIQUE", "ANTIK", "ANTIKUE"],
        "BUREAU": ["BUREAU", "BUREAUX", "BURO"],
        "LIBERAL": ["LIBERAL", "LITERAL", "LIVERAL"],
        "EPISODE": ["EPISODE", "EPIZODE", "EPISOD"]
      }
    };

    let revealed = Array(puzzle.target.length).fill("_");
    let score = parseInt(localStorage.getItem("fcScore") || "0");
    let validated = {};
    let fullSolved = false;

    function displayWord() {
      document.getElementById("hiddenWord").textContent = revealed.join(" ");
      document.getElementById("score").innerHTML = "Score: <strong>" + score + "</strong>";
    }

    function showListening(state) {
      document.getElementById("listening").textContent = state ? "🎤 Listening... Say the word now!" : "";
    }

    function speakAndCheck(word) {
      showListening(true);
      const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = "en-US";
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;

      recognition.onresult = function(event) {
        const spoken = event.results[0][0].transcript.toUpperCase().trim();
        showListening(false);

        if (puzzle.accepted[word].includes(spoken)) {
          const letter = word[0].toUpperCase();
          const pos = puzzle.target.indexOf(letter);
          if (pos >= 0 && revealed[pos] === "_") {
            revealed[pos] = letter;
            score += 1;
            validated[letter] = true;
            document.getElementById("result").textContent = `✅ Correct: You said "${spoken}"`;
          }
        } else {
          score -= 1;
          document.getElementById("result").textContent = `❌ Incorrect: You said "${spoken}"`;
        }

        localStorage.setItem("fcScore", score);
        displayWord();
        checkCompletion();
      };

      recognition.onerror = function(event) {
        showListening(false);
        document.getElementById("result").textContent = `⚠️ Error: ${event.error}`;
      };

      recognition.start();
    }

    function checkCompletion() {
      if (!revealed.includes("_") && !fullSolved) {
        fullSolved = true;
        score += 5;
        localStorage.setItem("fcScore", score);
        document.getElementById("result").textContent = "🎉 You completed the word TABLE! +5 points.";
        displayWord();
      }
    }

    function setupPuzzle() {
      const wordList = document.getElementById("wordList");
      wordList.innerHTML = "";
      puzzle.options.forEach(w => {
        const btn = document.createElement("button");
        btn.textContent = w;
        btn.onclick = () => speakAndCheck(w);
        wordList.appendChild(btn);
      });
      displayWord();
    }

    setupPuzzle();
  </script>
</body>
</html>
